---
title: "assignment2_ds"
format: html
editor: visual
---

```{r}
#| label: setup
#| echo: false
#| iutput: false
#| message: false
library(tidyverse)
library(vtable)
```

# **Er det BMI som bestemmer inntekt?**

Datasettet vi har brukt gjennom oppgaven er kalt *heights* og er en del av pakken modelr, Wickham ([2020](https://msb105.netlify.app/assignments/h23/ass2/ass2-h23#ref-modelr)), som er en utvidelspakke for statistikksystemet R, R Core Team ([2021](https://msb105.netlify.app/assignments/h23/ass2/ass2-h23#ref-Rcore)).

Følgende «chunk» er kode som samtlige grupper bør kjøre rett etter setup chunk-en slik at vi jobber med samme data og har samme variabelnavn.

```{r}
hoyde <- modelr::heights

hoyde <- hoyde %>% 
  mutate(
    bmi = weight * 0.4536/(height * 2.54/100)^2,
    married = fct_collapse(
      .f = marital,
      married = "married",
      other_level = "not married"
    ),
    edu_fac = cut(
      x = education,
      breaks = c(0, 12, 14, 16, 21),
      labels = c("not_hs", "not_cc", "not_col", "col_plus"),
      right = FALSE
    )
  ) |> 
  # reorganiserer data s.a. de fire faktor-variablerne kommer
  # lengst til høyre
  select(income:age, education:bmi, everything()) |>
  # Dropper marital og education siden disse ikke skal brukes
  select(-education, -marital)

# Inntekt lik 0
hoydeZeroInc <- hoyde |> 
  filter(income == 0)
# «Normal» inntekt
hoydeNormInc <- hoyde |> 
  filter(income > 0 & income < 343830)
hoydeHighInc <- hoyde |> 
  filter(income == 343830)
```

## Tre nye datasett

```{r}
hoydeZeroInc |> st()
```

```{r}
hoydeZeroInc |> vt()
```

```{r}
hoydeNormInc |> st()
```

```{r}
hoydeNormInc |> vt()
```

```{r}
hoydeHighInc |> st()
```

```{r}
hoydeHighInc |> vt()
```

## Scatter plot for høyde og inntekt

```{r}
hoyde  |> 
  ggplot(
  mapping = aes(
    x = height,
    y = income
    )
  ) + 
  geom_jitter(
    size = 1,
    alpha = 0.40
    ) +
  geom_smooth(
    formula = y ~ x,
    method = "lm",
    colour = "black",
    lwd = 0.75,
    se = FALSE
    )
```

```{r}
hoydeNormInc  |> 
  ggplot(
  mapping = aes(
    x = height,
    y = income
    )
  ) + 
  geom_jitter(
    size = 1,
    alpha = 0.40
    ) +
  geom_smooth(
    formula = y ~ x,
    method = "lm",
    colour = "black",
    lwd = 0.75,
    se = FALSE
    )
```

## Histogram for to subsets

```{r}
meanHeightMale <- hoyde |> 
  filter(sex == 'male') %>% 
  select(height) |> 
  # konverterer en tibble med 3402 rekker og 1 kolonne
  # til en vektor med 3402 elementer siden mean() forlanger en
  # vektor som input
  pull() |> 
  # finner gjennomsnittet av verdiene i vektoren
  mean()

meanHeightFemale <- hoyde |> 
  filter(sex == 'female') %>% 
  select(height) |> 
  pull() |> 
  mean()

# standard deviation
sdHeightMale <- hoyde |> 
  filter(sex == 'male') |> 
  select(height) |> 
  pull() |> 
  sd()

sdHeightFemale <- hoyde |>
  filter(sex == 'female') |>
  select(height) |>
  pull() |> 
  sd()
```

```{r}
hoyde %>%
  ggplot() +
  ### male ###
  geom_histogram(
    data = filter(hoyde, sex == "male"),
    mapping = aes(x = height, y = after_stat(density)),
    binwidth = 1, alpha = 0.3, colour = 'grey40', fill = 'grey40'
    ) + 
  geom_vline(
    xintercept = meanHeightMale,
    colour = 'grey40', lwd = 0.75, linetype = 3
    ) +
  stat_function(
    fun = dnorm,
    args = list(mean = meanHeightMale, sd = sdHeightMale),
    colour = 'grey40'
    ) +
  # female
  geom_histogram(
    data = filter(hoyde, sex == "female"),
    mapping = aes(x = height, y = after_stat(density)),
    binwidth = 1, alpha = 0.7, colour = 'black', fill = 'grey40'
    ) +
  stat_function(
    fun = dnorm, args = list(mean = meanHeightFemale, sd = sdHeightFemale),
    colour = 'black'
    ) +
  geom_vline(
    xintercept = meanHeightFemale, colour = 'grey40', lwd = 0.75, linetype = 3
    ) 
```

## Gruppe 5: Sammenheng mellom bmi inntekt

Først skal vi se på sammenhengen mellom bmi og inntekt.

Da

```{r}
bmi_inntekt <- hoydeNormInc |> 
  select(income, bmi)
```

```{r}
ggplot(bmi_inntekt, aes(x = bmi, y = income)) +
  geom_point() + 
  labs(title = "Scatterplot av sammenhengen mellom BMI og inntekt" 
       )
```

Kommentar: Utifra datasettet som tar for seg inntekt og bmi får vi et raskt overblikk over de som skiller seg ut.
Her ser vi at jo høyere BMI desto lavere inntekt.
Dette er et datasett med ekstremt mange observasjoner og vi vil nå filtrere ut for å få et større bilde av hvordan BMI og inntekt faktisk henger sammen.

Vi øsnker å se sammenhengen, herav om det er korrelasjon

```{r}
#renser datasettet for NA verdier
renset_dataset <- na.omit(bmi_inntekt)
```

```{r}
correlation <- cor(hoydeNormInc$bmi, hoydeNormInc$income, use = "complete.obs")
cat("Pearson-korrelasjon mellom BMI og inntekt:", correlation)
```

Kommentar:
Verdien -0,05105 indikerer en svak negativ korrelasjon.
Dette betyr at når "bmi" øker, har "income" en tendens til å være litt lavere, og når "bmi" reduseres, har "income" en tendens til å være litt høyere.
Imidlertid er korrelasjonen så svak at det er vanskelig å trekke sterke konklusjoner basert bare på denne verdien.

For å få en dypere innsikt i sammenhengen mellom disse variablene og eventuelle underliggende faktorer, vil vi utføre ytterligere analyse med å trekke inn kjønn, gift/ugift og utdanning.

## Sammenheng bmi og inntektsforskjell mellom menn/kvinner

```{r}
bmi_inntekt_sex <- hoydeNormInc |> 
  select(sex, income, bmi,)
```

```{r}
renset_dataset2 <- na.omit(bmi_inntekt_sex)
```

```{r}
ggplot(bmi_inntekt_sex, aes(x = bmi, y = income, color = sex)) +
  geom_point() + 
  labs(title = "Scatterplot av sammenhengen mellom BMI og inntekt" 
       )
```

Videre lager vi to datasett, ett for kvinner og ett for menn

```{r}
menn <- filter(renset_dataset2, sex == "male")
kvinner <- filter(renset_dataset2, sex == "female")
```

```{r}
menn_summary <- summarize(menn, Avg_BMI = mean(bmi), Avg_Income = mean(income))
kvinner_summary <- summarize(kvinner, Avg_BMI = mean(bmi), Avg_Income = mean(income))
```

```{r}
print(menn_summary) 
print(kvinner_summary)
```

Som vi ser er average på kvinner og menn sin bmi nokså lik.
I datasettet vårt har vi 2520 observasjoner av menn og 2534 observasjoner av kvinner som vil si at det er innhentet nokså lik data på kjønnene noe som gjør tallene vi får realistiske.

Videre kan vi se på inntekten.
Gjennomsnittlig inntekt for menn ligger noe høyere enn kvinner, herav 54280 og 39401.
HVA SIER DETTE OSS?

```{r}
#| echo: false
# siste
```
