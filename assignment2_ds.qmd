---
title: "assignment2_ds"
format: html
editor: visual
---

```{r}
#| label: setup
#| echo: false
#| iutput: false
#| message: false
library(tidyverse)
library(vtable)
```

# **Er det BMI som bestemmer inntekt?**

Datasettet vi har brukt gjennom oppgaven er kalt *heights* og er en del av pakken modelr, Wickham ([2020](https://msb105.netlify.app/assignments/h23/ass2/ass2-h23#ref-modelr)), som er en utvidelspakke for statistikksystemet R, R Core Team ([2021](https://msb105.netlify.app/assignments/h23/ass2/ass2-h23#ref-Rcore)).

Følgende «chunk» er kode som samtlige grupper bør kjøre rett etter setup chunk-en slik at vi jobber med samme data og har samme variabelnavn.

```{r}
hoyde <- modelr::heights

hoyde <- hoyde %>% 
  mutate(
    bmi = weight * 0.4536/(height * 2.54/100)^2,
    married = fct_collapse(
      .f = marital,
      married = "married",
      other_level = "not married"
    ),
    edu_fac = cut(
      x = education,
      breaks = c(0, 12, 14, 16, 21),
      labels = c("not_hs", "not_cc", "not_col", "col_plus"),
      right = FALSE
    )
  ) |> 
  # reorganiserer data s.a. de fire faktor-variablerne kommer
  # lengst til høyre
  select(income:age, education:bmi, everything()) |>
  # Dropper marital og education siden disse ikke skal brukes
  select(-education, -marital)

# Inntekt lik 0
hoydeZeroInc <- hoyde |> 
  filter(income == 0)
# «Normal» inntekt
hoydeNormInc <- hoyde |> 
  filter(income > 0 & income < 343830)
hoydeHighInc <- hoyde |> 
  filter(income == 343830)
```

```{r}
hoyde <- modelr::heights
```

```{r}
hoyde |>  st()
```

Kommenter fra datasettet.

Videre bruker mutate for å lage en variabel som forteller oss BMI.

```{r}
hoyde <- hoyde %>% 
  mutate(
    bmi = weight * 0.4536 / (height * 2.54 / 100)^2,
    married = fct_collapse(
      .f = marital,
      married = "married",
      other_level = "not married"
    ))
```

Videre forenkler vi education slik at vi skiller mellom kategorier Not High School Exam (not_hs), Not Community College (not_cc), Not College (not_col) og 4 years College or more (col_plus).

```{r}
edu_fac = cut(
      x = education,
      breaks = c(0, 12, 14, 16, 21),
      labels = c("not_hs", "not_cc", 
                    "not_col", "col_plus"),
      right = FALSE
    )
  )
```

```{r}
  select(income:age, education:bmi, everything())
```

```{r}
  select(-education, -marital)
```

```{r}
hoyde |> vt(missing = TRUE)
```

Datasettet Høyde skal videre deles inn i tre; hoyde_inc_zero, hoyde_inc_norm og hoyde_inc_high.

```{r}
# Inntekt lik 0
hoydeZeroInc <- hoyde |> 
  filter(income == 0)
# «Normal» inntekt
hoydeNormInc <- hoyde |> 
  filter(income > 0 & income < 343830)
# Høy inntekt
hoydeHighInc <- hoyde |> 
  filter(income == 343830)
```

## Tre nye datasett

```{r}
hoydeZeroInc |> st()
```

```{r}
hoydeZeroInc |> vt()
```

```{r}
hoydeNormInc |> st()
```

```{r}
hoydeNormInc |> vt()
```

```{r}
hoydeHighInc |> st()
```

```{r}
hoydeHighInc |> vt()
```

## Scatter plot for høyde og inntekt

```{r}
hoyde  |> 
  ggplot(
  mapping = aes(
    x = height,
    y = income
    )
  ) + 
  geom_jitter(
    size = 1,
    alpha = 0.40
    ) +
  geom_smooth(
    formula = y ~ x,
    method = "lm",
    colour = "black",
    lwd = 0.75,
    se = FALSE
    )
```

```{r}
hoydeNormInc  |> 
  ggplot(
  mapping = aes(
    x = height,
    y = income
    )
  ) + 
  geom_jitter(
    size = 1,
    alpha = 0.40
    ) +
  geom_smooth(
    formula = y ~ x,
    method = "lm",
    colour = "black",
    lwd = 0.75,
    se = FALSE
    )
```

## Histogram for to subsets

```{r}
meanHeightMale <- hoyde |> 
  filter(sex == 'male') %>% 
  select(height) |> 
  # konverterer en tibble med 3402 rekker og 1 kolonne
  # til en vektor med 3402 elementer siden mean() forlanger en
  # vektor som input
  pull() |> 
  # finner gjennomsnittet av verdiene i vektoren
  mean()

meanHeightFemale <- hoyde |> 
  filter(sex == 'female') %>% 
  select(height) |> 
  pull() |> 
  mean()

# standard deviation
sdHeightMale <- hoyde |> 
  filter(sex == 'male') |> 
  select(height) |> 
  pull() |> 
  sd()

sdHeightFemale <- hoyde |>
  filter(sex == 'female') |>
  select(height) |>
  pull() |> 
  sd()
```

```{r}
hoyde %>%
  ggplot() +
  ### male ###
  geom_histogram(
    data = filter(hoyde, sex == "male"),
    mapping = aes(x = height, y = after_stat(density)),
    binwidth = 1, alpha = 0.3, colour = 'grey40', fill = 'grey40'
    ) + 
  geom_vline(
    xintercept = meanHeightMale,
    colour = 'grey40', lwd = 0.75, linetype = 3
    ) +
  stat_function(
    fun = dnorm,
    args = list(mean = meanHeightMale, sd = sdHeightMale),
    colour = 'grey40'
    ) +
  # female
  geom_histogram(
    data = filter(hoyde, sex == "female"),
    mapping = aes(x = height, y = after_stat(density)),
    binwidth = 1, alpha = 0.7, colour = 'black', fill = 'grey40'
    ) +
  stat_function(
    fun = dnorm, args = list(mean = meanHeightFemale, sd = sdHeightFemale),
    colour = 'black'
    ) +
  geom_vline(
    xintercept = meanHeightFemale, colour = 'grey40', lwd = 0.75, linetype = 3
    ) 
```

## Gruppe 5: Sammenheng mellom bmi inntekt

Først skal vi se på sammenhengen mellom bmi og inntekt.

Da

```{r}
bmi_inntekt <- hoydeNormInc |> 
  select(income, bmi)
```

```{r}
ggplot(bmi_inntekt, aes(x = bmi, y = income)) +
  geom_point() + 
  labs(title = "Scatterplot av sammenhengen mellom BMI og inntekt" 
       )
```

Kommentar: Utifra datasettet som tar for seg inntekt og bmi får vi et raskt overblikk over de som skiller seg ut.
Her ser vi at jo høyere BMI desto lavere inntekt.
Dette er et datasett med ekstremt mange observasjoner og vi vil nå filtrere ut for å få et større bilde av hvordan BMI og inntekt faktisk henger sammen.

Vi øsnker å se sammenhengen, herav om det er korrelasjon

```{r}
#renser datasettet for NA verdier
renset_dataset <- na.omit(bmi_inntekt)
```

```{r}
correlation <- cor(hoydeNormInc$bmi, hoydeNormInc$income, use = "complete.obs")
cat("Pearson-korrelasjon mellom BMI og inntekt:", correlation)
```

Kommentar: Verdien -0,05105 indikerer en svak negativ korrelasjon.
Dette betyr at når "bmi" øker, har "income" en tendens til å være litt lavere, og når "bmi" reduseres, har "income" en tendens til å være litt høyere.
Imidlertid er korrelasjonen så svak at det er vanskelig å trekke sterke konklusjoner basert bare på denne verdien.

For å få en dypere innsikt i sammenhengen mellom disse variablene og eventuelle underliggende faktorer, vil vi utføre ytterligere analyse med å trekke inn kjønn, gift/ugift og utdanning.

## Sammenheng bmi og inntektsforskjell mellom menn/kvinner

```{r}
bmi_inntekt_sex <- hoydeNormInc |> 
  select(sex, income, bmi,)
```

```{r}
 renset_dataset2 <- na.omit(bmi_inntekt_sex)
```

```{r}
ggplot(bmi_inntekt_sex, aes(x = bmi, y = income, color = sex)) +
  geom_point() + 
  labs(title = "Scatterplot av sammenhengen mellom BMI og inntekt" 
       )
```

```{r}
library(dplyr)

# Grupper data etter kjønn og beregn statistikk
summary_stats <- renset_dataset2 %>%
  group_by(sex) %>%
  summarize(
    Mean_BMI = mean(bmi),
    Mean_Income = mean(income),
  )

# Vis resultatene
print(summary_stats)

```

Som vi ser er average på kvinner og menn sin bmi nokså lik.
I datasettet vårt har vi 2520 observasjoner av menn og 2534 observasjoner av kvinner som vil si at det er innhentet nokså lik data på kjønnene noe som gjør tallene vi får realistiske. 

Videre kan vi se på inntekten.
Gjennomsnittlig inntekt for menn ligger noe høyere enn kvinner, herav 54280 og 39401.
Ser vi på gjennomsnittlig BMI så kommer menn og kvinner så og si likt ut, herav på menn 29,23362 og kvinner 29,16163.
I følge "AARTIKKEL" klassifiseres normalvekt med en BMI mellom 18,5-24,9, som vil si at gjennomsnittet ++ som er med i dataene er overvektige.

```{r}
library(dplyr)

# Filtrer datasettet for menn og kvinner
male_data <- filter(renset_dataset2, sex == "male")
female_data <- filter(renset_dataset2, sex == "female")

# Beregn korrelasjonen mellom BMI og inntekt for menn
correlation_male <- cor(male_data$bmi, male_data$income, use = "complete.obs")
cat("Pearson correlation between BMI and Income for Men:", correlation_male, "\n")

# Beregn korrelasjonen mellom BMI og inntekt for kvinner
correlation_female <- cor(female_data$bmi, female_data$income, use = "complete.obs")
cat("Pearson correlation between BMI and Income for Women:", correlation_female)

```

-   For menn er det en svak negativ korrelasjon (ca. -0.019), noe som antyder at det er en liten tendens til at BMI reduseres når inntekten øker, men sammenhengen er svært svak.

-   For kvinner er det også en svak negativ korrelasjon (ca. -0.089), som indikerer en lignende tendens, men igjen, sammenhengen er relativt svak.

Dette betyr at det er en svak tendens til at personer med høyere inntekt har litt lavere BMI, både blant menn og kvinner, men sammenhengen er ikke spesielt sterk.
Det kan være andre faktorer som påvirker BMI og inntekt i tillegg til kjønn, og det er viktig å vurdere disse faktorene for å få en mer helhetlig forståelse av sammenhengen.

```{r}

# Scatterplot for sammenhengen mellom BMI og inntekt for menn
ggplot(male_data, aes(x = bmi, y = income)) +
  geom_point() +
  labs(title = "Sammenheng mellom BMI og Inntekt for Menn")

# Scatterplot for sammenhengen mellom BMI og inntekt for kvinner
ggplot(female_data, aes(x = bmi, y = income)) +
  geom_point() +
  labs(title = "Sammenheng mellom BMI og Inntekt for Kvinner")

```

## 
Sammenheng bmi og inntektsforskjell mellom menn/kvinner gitt gift/ugift

```{r}
bmi_inntekt_sex_married <- hoydeNormInc |> 
  select(sex, income, bmi, married)
```

```{r}
renset_dataset3 <- na.omit(bmi_inntekt_sex_married)
```

```{r}
# Opprett et scatterplot
ggplot(bmi_inntekt_sex_married, aes(x = bmi, y = income, color = sex, shape = married)) +
  geom_point() +
  labs(title = "Sammenheng mellom BMI og Inntekt etter Kjønn og Sivilstand") +
  scale_color_manual(values = c("male" = "blue", "female" = "red")) +
  scale_shape_manual(values = c("married" = 15, "not married" = 1))

```

```{r}

# Plott for gifte (married)
plot_married <- ggplot(filter(bmi_inntekt_sex_married, married == "married"), aes(x = bmi, y = income, color = sex)) +
  geom_point() +
  labs(title = " Gifte (Married)")

# Plott for ugifte (not married)
plot_not_married <- ggplot(filter(bmi_inntekt_sex_married, married == "not married"), aes(x = bmi, y = income, color = sex)) +
  geom_point() +
  labs(title = " Ugifte (Not Married)")

# Kombiner plottene
library(gridExtra)
grid.arrange(plot_married, plot_not_married, ncol = 2)

```

```{r}
# Filtrer datasettet for menn og kvinner
married_data <- filter(renset_dataset3, married == "married")
notmarried_data <- filter(renset_dataset3, married == "not married")

# Beregn korrelasjonen mellom BMI og inntekt for married
correlation_married <- cor(married_data$bmi, married_data$income, use = "complete.obs")
cat("Pearson correlation between BMI and Income for married:", correlation_married, "\n")

# Beregn korrelasjonen mellom BMI og inntekt for not married 
correlation_notmarried <- cor(notmarried_data$bmi, notmarried_data$income, use = "complete.obs")
cat("Pearson correlation between BMI and Income for not married:", correlation_notmarried)
```

1.  **Pearson-korrelasjon mellom BMI og Income for married (gifte): -0.0563821**

    -   Denne verdien (-0.0563821) indikerer en svak negativ korrelasjon mellom BMI og inntekt blant gifte individer.
        Med andre ord, det er en liten tendens til at gifte personer med høyere BMI-verdier har litt lavere inntekt, og gifte personer med lavere BMI-verdier har litt høyere inntekt.
        Den negative korrelasjonen tyder på en motsatt trend, men sammenhengen er svak.

2.  **Pearson-korrelasjon mellom BMI og Income for not married (ugifte): -0.03155596**

    -   Denne verdien (-0.03155596) indikerer også en svak negativ korrelasjon mellom BMI og inntekt blant ugifte individer.
        På samme måte som for gifte, antyder dette at ugifte personer med høyere BMI-verdier har litt lavere inntekt, og ugifte personer med lavere BMI-verdier har litt høyere inntekt.
        Igjen er sammenhengen svak.

Sammenfattende viser resultatene at det er en svak tendens til at både gifte og ugifte individer med høyere BMI-verdier har litt lavere inntekt, men sammenhengen er ikke spesielt sterk.
Dette betyr at BMI alene ikke er en sterk prediktor for inntekt, uavhengig av sivilstand.
Andre faktorer kan spille en viktigere rolle i å påvirke inntekten til både gifte og ugifte personer i datasettet ditt.

```{r}
# Grupper data etter kjønn og beregn statistikk
summary_stats3 <- renset_dataset3 %>%
  group_by(married, sex) %>%
  summarize(
    Mean_BMI = mean(bmi),
    Mean_Income = mean(income),
  )

# Vis resultatene
print(summary_stats3)
```

Menn som er gift har høyere inntekt enn men som ikke er gift men har også høyre BMI enn de som ikke er gift.
Kvinner som er gift har også høyere inntekt enn kvinner som ikke er gift men kvinner som er gift har lavere BMI enn kvinner som ikke er gift.

## Sammenheng bmi og inntektsforskjell mellom menn/kvinner gitt edu_fac

## Resultater/konklusjon

## References

```{r}
#| echo: false
# siste
```
